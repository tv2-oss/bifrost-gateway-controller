resources:
- ../default

patchesStrategicMerge:
  - |-
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: bifrost-gateway-controller-controller-manager
      namespace: bifrost-gateway-controller-system
    spec:
      template:
        spec:
          containers:
            - name: manager
              image: "ghcr.io/tv2-oss/bifrost-gateway-controller:latest"
              imagePullPolicy: "Never"
  - |-
    apiVersion: rbac.authorization.k8s.io/v1
    kind: ClusterRole
    metadata:
      name: manager-role
    rules:
    # These are extensions to get the e2e test and getting-started guide to work. This is beyond those generated by controller-gen
    - apiGroups:
      - ""
      resources:
      - configmaps
      - namespaces
      verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch
    - apiGroups:
      - cert-manager.io
      resources:
      - certificates
      verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch
    - apiGroups:
      - networking.k8s.io
      resources:
      - ingresses
      verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch
    - apiGroups:
      - autoscaling
      resources:
      - horizontalpodautoscalers
      verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch
    - apiGroups:
      - policy
      resources:
      - poddisruptionbudgets
      verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch
    # Below are copied from role.yaml
    - apiGroups:
      - gateway.networking.k8s.io
      resources:
      - gatewayclasses
      verbs:
      - get
      - list
      - watch
    - apiGroups:
      - gateway.networking.k8s.io
      resources:
      - gatewayclasses/finalizers
      verbs:
      - update
    - apiGroups:
      - gateway.networking.k8s.io
      resources:
      - gatewayclasses/status
      verbs:
      - get
      - patch
      - update
    - apiGroups:
      - gateway.networking.k8s.io
      resources:
      - gateways
      verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch
    - apiGroups:
      - gateway.networking.k8s.io
      resources:
      - gateways/finalizers
      verbs:
      - update
    - apiGroups:
      - gateway.networking.k8s.io
      resources:
      - gateways/status
      verbs:
      - get
      - patch
      - update
    - apiGroups:
      - gateway.networking.k8s.io
      resources:
      - httproutes
      verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch
    - apiGroups:
      - gateway.networking.k8s.io
      resources:
      - httproutes/finalizers
      verbs:
      - update
    - apiGroups:
      - gateway.networking.k8s.io
      resources:
      - httproutes/status
      verbs:
      - get
      - patch
      - update
    - apiGroups:
      - gateway.tv2.dk
      resources:
      - gatewayclassblueprints
      verbs:
      - get
      - list
      - watch
    - apiGroups:
      - gateway.tv2.dk
      resources:
      - gatewayclassblueprints/finalizers
      verbs:
      - update
    - apiGroups:
      - gateway.tv2.dk
      resources:
      - gatewayclassblueprints/status
      verbs:
      - get
      - patch
      - update
    - apiGroups:
      - gateway.tv2.dk
      resources:
      - gatewayclassconfigs
      verbs:
      - get
      - list
      - watch
    - apiGroups:
      - gateway.tv2.dk
      resources:
      - gatewayclassconfigs/finalizers
      verbs:
      - update
    - apiGroups:
      - gateway.tv2.dk
      resources:
      - gatewayclassconfigs/status
      verbs:
      - get
      - patch
      - update
    - apiGroups:
      - gateway.tv2.dk
      resources:
      - gatewayconfigs
      verbs:
      - get
      - list
      - watch
    - apiGroups:
      - gateway.tv2.dk
      resources:
      - gatewayconfigs/finalizers
      verbs:
      - update
    - apiGroups:
      - gateway.tv2.dk
      resources:
      - gatewayconfigs/status
      verbs:
      - get
      - patch
      - update
